<!DOCTYPE html>
<!--[if IE 8]>         <html class="no-js lt-ie9" lang="en"> <![endif]-->
<!--[if gt IE 8]><!--> 
<html class="no-js" lang="en"> <!--<![endif]-->

<head>

	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width" />

	<title>Friend Voyage | Traveling just got a lot more social...</title>

	<link rel="stylesheet" href="css/normalize.css" />
	<link rel="stylesheet" href="css/foundation.css" />
	<link rel="stylesheet" href="http://code.jquery.com/ui/1.10.2/themes/smoothness/jquery-ui.css" />
  <link rel="stylesheet" href="css/jquery.share.css" />

  <style type="text/css">
  #map_canvas{
    height:550px;
    width:100%;
  }
  #selections{
    position:fixed;
    top:55px;
    left:75px;
    width:300px;
  }
  label{
    padding:5px;
  }
  #submitselectionbutton{
    padding:5px;
  }
  #header,
  #footer{
    height:50px;
  }
  p.title{
    height:50px;
    padding:10px;
  }
  .pictureselect{
    opacity: .25;
  }
  .pictureselect p{
    font:12px;
    float:left;
  }
  .pictureselect:hover{
    opacity: .5;
  }
  .pictures{
    width:100%;
    -moz-column-count:4; /* Firefox */
    -webkit-column-count:4; /* Safari and Chrome */
    column-count:4;
    text-align: center;
    font-size: 10px
  }
  #registerview,
  #resetview,
  #resetviewinfofilled,
  #registerwith{
    visibility: hidden;
    position:absolute;
  }
  #signinview,
  #signinwith{
    visibility: visible;
    position:absolute;
  }
  #signinmodal{
    height:525px;
  }
  .socialdiv{
    float:left;
    margin-left:300px;
    margin-right:20px;
    padding:20px;
  }
  .viewdiv{
    float:left;
  }
  h3{
    font-size: 14px;
    padding:5px;
  }
  #filterselections{
    background-color: #CCCCCC;
  }
  #recheader{
    margin-top: -20px;
  }
  #finditheader{
    margin-top: -10px;
  }
  </style>

</head>

<body onload="initMap()">

  <!-- header included from header-->
  <div id="header">
    <img src= "img/friendvoyage.png" style="
    margin-top: 5px;"></img>
  </div>

  <!-- body includes map-->
  <div id="body">
    <div id="map_canvas"></div>
  </div>

  <!-- selections which include the icons and the steps to recommend a place-->
  <div id="selections">
    <div id="filterselections">
      <h3 class="subheader">Select a recommendation:</h3>
      <div id="activities">
        <form class="pictures">
          <img class="pictureselect" src="img/arts.png" title="arts" id="arts" onclick="selectimage('arts')"/><p>Arts</p>
          <img class="pictureselect" src="img/coffee.png" title="coffee" id="coffee" onclick="selectimage('coffee')"/><p>Coffee</p>
          <img class="pictureselect" src="img/drinks.png" title="drinks" id="drinks" onclick="selectimage('drinks')"/><p>Drinks</p>
          <img class="pictureselect" src="img/family.png" title="family" id="family" onclick="selectimage('family')"/><p>Family</p>
          <img class="pictureselect" src="img/food.png" title="food" id="food" onclick="selectimage('food')"/><p>Food</p>
          <img class="pictureselect" src="img/nightlife.png" title="nightlife" id="nightlife" onclick="selectimage('nightlife')"/><p>Nightlife</p>
          <img class="pictureselect" src="img/shopping.png" title="shopping" id="shopping" onclick="selectimage('shopping')"/><p>Shopping</p>
          <img class="pictureselect" src="img/sights.png" title="sights" id="sights" onclick="selectimage('sights')"/><p>Sights</p>
        </form>
      </div>

      <h3 class="subheader" id="recheader">Say something about your recommendation:</h3>
      <div id="recommendations">
        <div class="row">
          <div class="large-12 columns">
            <textarea id="recommendationtext" placeholder="Tell Your Friend Why You Recommend This Place"></textarea>
          </div>
        </div>
      </div>

      <h3 class="subheader" id="finditheader">Find it on the map and add away!:</h3>
      <div class="row">
        <div class="large-12 columns">        
          <div class="row collapse">

            <div class="large-9 small-9 columns">
              <input type="text" id="address" placeholder="Add Recommendation">
            </div>

            <div class="large-3 small-3 columns">
              <a href="#" class="button prefix" id = "valuesubmit" onclick="addtolist(address.value)">Add</a>
            </div>

            <div class="placeselected" id="addingcities">
            </div>

          </div>

        </div>

      </div>

    </div>

  </div>

  <div id="footer">
  </div>

  <script src="http://code.jquery.com/jquery-latest.min.js"></script>
  <script src="js/vendor/custom.modernizr.js"></script>
  <script type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=false"></script>
  <script src="https://maps.googleapis.com/maps/api/js?v=3.exp&sensor=false&libraries=places"></script>
  <script src="http://code.jquery.com/jquery-1.9.1.js"></script>
  <script src="http://code.jquery.com/ui/1.10.2/jquery-ui.js"></script>
  <script src="js/jquery.share.js"></script>                     

  <script type="text/javascript">
    //initializes the datepicker
    //$('#fromdatepicker').datepicker();
    //$('#todatepicker').datepicker();						

    //initializes share
    $(document).ready(function () {
      $('#socialnetworks').share({
        networks: ['facebook','twitter','googleplus','linkedin','pinterest','tumblr','stumbleupon','email'],
        theme: 'square'
      });
    });

    //closes the modal by the button
    function closeModal(id){
		    //$('a.close-reveal-modal').trigger('click');
		    $(id).foundation('reveal', 'close');
      }

      function openModal(id){
        $(id).foundation('reveal', 'open');
      }

    //selects the image icon to be placed on the map
    var imageicon;   

    //image selector, which changes the CSS from semi transparent to completely selected
    var selectimage = function(obj){
      if(document.getElementById(obj).style.opacity < "1"){
        document.getElementById(obj).style.opacity = "1";
      }
      else{
        document.getElementById(obj).style.opacity = ".25";
      }
      imageicon = 'img/'+obj+'.png';
    }

    //initializes map
    function initMap(){
		//initializing modal the opening window
		//$('#myModal').foundation('reveal', 'open');
		//$('#myModal').foundation('reveal', 'close');
        //initializing the map
        var map;
        var myOptions = {
        	zoom: 2,
        	center: latlng = new google.maps.LatLng(0, 0),
        	mapTypeId: google.maps.MapTypeId.ROADMAP
        };
        var marker = new google.maps.Marker({});

        //initialize auto complete
        var input = document.getElementById('address');
        var autocomplete = new google.maps.places.Autocomplete(input);
        //autocomplete.bindTo('bounds', map);
        var infowindow = new google.maps.InfoWindow({});

        google.maps.event.addListener(autocomplete, 'place_changed', function() {
        	infowindow.close();
        	marker.setVisible(true);
        	input.className = '';
        	var place = autocomplete.getPlace();
        	if (!place.geometry) {
            // Inform the user that the place was not found and return.
            input.className = 'notfound';
            return;
          }

          // If the place has a geometry, then present it on a map.
          if (place.geometry.viewport) {
          	map.fitBounds(place.geometry.viewport);
          } else {
          	map.setCenter(place.geometry.location);
            map.setZoom(17);  // Why 17? Because it looks good.
          }
          marker.setPosition(place.geometry.location);
          marker.setVisible(true);

          var address = '';
          if (place.address_components) {
           address = [
           (place.address_components[0] && place.address_components[0].short_name || ''),
           (place.address_components[1] && place.address_components[1].short_name || ''),
           (place.address_components[2] && place.address_components[2].short_name || '')
           ].join(' ');
         }

         console.log(place)
         var e = {
           latLng: {
            lat: function () {
             return place.geometry.location.jb;
           },
           lng: function () {
             return place.geometry.location.kb;
           }
         }
       }
       addMarkerHandler(e);
       addtolist(place.formatted_address);
     });

google.maps.event.addDomListener(window, 'load', initMap);

        //instance of the map
        var map = new google.maps.Map(document.getElementById("map_canvas"), myOptions);
        //array to hold all the markers
        var markers = {};
        //create id for marker
        var markeridcreator=function(lat, lng){return lat + '_' + lng;};
        //create a lat lng getter
        var getlatlng = function(lat, lng){return new google.maps.LatLng(lat, lng);};
        //add marker
        //var addMarker = google.maps.event.addListener(map, 'click', addMarkerHandler);
        //function that is called when addMarker is called

        var addMarkerHandler = function(e){
        	console.log(e);
        	var lat = e.latLng.lat();
        	var lng = e.latLng.lng();
        	var markerid = markeridcreator(lat, lng);
        	var marker = new google.maps.Marker({
        		position: getlatlng(lat, lng),
        		map: map,
        		id: 'marker_' + markerid,
        		icon: imageicon
        	});

          markers[markerid] = marker;
          markerevent(marker);

        	//reverse lookup
        	var geocoder = new google.maps.Geocoder();
        	var infowindow = new google.maps.InfoWindow();
        	var latlng = getlatlng(lat, lng);
        	geocoder.geocode({'latLng': latlng}, function(results) {
        		infowindow.setContent(results[1].formatted_address);
            //infoWindow.setContent(document.getElementById("recommendationtext").value);
        		//infowindow.open(map, marker);	
                //placename = results[1].formatted_address;
              });
          google.maps.event.addListener(marker, 'click', function() {
            infowindow.open(map,marker);
          });

        }
        //marker event binder
        var markerevent = function(marker){
        	google.maps.event.addListener(marker, "rightclick", function(e){
        		var markerid = markeridcreator(e.latLng.lat(), e.latLng.lng());
        		var marker = markers[markerid];
        		deletemarker(marker, markerid);
        	});
        };

        //marker delete
        var deletemarker = function(marker, markerid){
        	marker.setMap(null);
        	delete markers[markerid];
            //removefromlist(placename);
          };	
        //remove value from list
        var removefromlist = function(val){
          $("#addingcities ul").remove('<li><a href="#">'+val+'</a></li>');
            //$("#addingcities ul").update();
          }
        }
    //add the inputted item in the list
    var addtolist = function(val){
    	//$("#addingcities ul").append('<li><a href="#">'+val+'</a></li>');
    	$("#valuesubmit").val("");
    }
    </script>

    <script>
    	//must add in order for foundation to work
    	document.write('<script src=' +
    		('__proto__' in {} ? 'js/vendor/zepto' : 'js/vendor/jquery') +
    		'.js><\/script>')
    	</script>
    	<script src="js/foundation/foundation.js"></script>
    	<script src="js/foundation/foundation.alerts.js"></script>
    	<script src="js/foundation/foundation.clearing.js"></script>
    	<script src="js/foundation/foundation.cookie.js"></script>
    	<script src="js/foundation/foundation.dropdown.js"></script>
    	<script src="js/foundation/foundation.forms.js"></script>
    	<script src="js/foundation/foundation.joyride.js"></script>
    	<script src="js/foundation/foundation.magellan.js"></script>
    	<script src="js/foundation/foundation.orbit.js"></script>
    	<script src="js/foundation/foundation.placeholder.js"></script>
    	<script src="js/foundation/foundation.reveal.js"></script>
    	<script src="js/foundation/foundation.section.js"></script>
    	<script src="js/foundation/foundation.tooltips.js"></script>
    	<script src="js/foundation/foundation.topbar.js"></script>
    	<script>
    	$(document).foundation();
    	</script>

      <div id="linkmodal" class="reveal-modal">
        <h2>Congratulations! Here is the link for your map. Share it with your friends!</h2>
        <input type="text" id="linktomap" value="file:///C:/Users/Rodrigo/SkyDrive/Code/FriendVoyage/recommendation.html" onclick="window.open('Recommendations.html', '_self')"/>
        <p>Share it on your favorite social networks too!</p>
        <div id="socialnetworks"></div></br>
        <a href="#" class="large button" onclick="window.open('Results.html', '_self')">Take Me Home</a>
        <a class="close-reveal-modal">&#215;</a>
      </div>  

    </body>
    </html>